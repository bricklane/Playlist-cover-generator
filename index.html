<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generative Art with Voronoi</title>
<script src="https://d3js.org/d3.v5.min.js"></script>
<style>
  #artCanvas {
    width: 300px;
    height: 300px;
    display: block;
    border: 1px solid black; /* Optional: to see the canvas boundaries */
  }
  .button {
    padding: 10px;
    margin: 5px;
    cursor: pointer;
  }
</style>
</head>
<body>
<canvas id="artCanvas" width="300" height="300"></canvas>
<button class="button" onclick="createPattern()">Create</button>
<button class="button" onclick="savePattern()">Save</button>

<script>
// Function to generate a random color
function getRandomColor() {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i < 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}

// Function to create the Voronoi pattern
function createPattern() {
  var canvas = document.getElementById('artCanvas');
  var ctx = canvas.getContext('2d');
  var width = canvas.width;
  var height = canvas.height;

  // Clear previous pattern
  ctx.clearRect(0, 0, width, height);

  // Generate random points for the Voronoi diagram
  var points = d3.range(30).map(function(d) { // 30 points for a less crowded diagram
    return [Math.random() * width, Math.random() * height];
  });

  // Create the Voronoi diagram
  var voronoi = d3.voronoi().extent([[0, 0], [width, height]]);
  var diagram = voronoi(points);

  // Optionally, set a stroke style for the diagram edges if you wish to see the lines
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 0.5;

  // Draw the Voronoi polygons
  diagram.cells.forEach(function(cell) {
    if (cell) {
      var points = cell.halfedges.map(function(i) {
        var edge = diagram.edges[i];
        return edge[0]; // Get the start point of the edge
      });
      
      // To ensure the shape is closed, push the first point to the end of the array
      points.push(points[0]);
      
      ctx.beginPath();
      ctx.moveTo(points[0][0], points[0][1]);

      // Draw lines to each point in the cell
      points.forEach(function(point) {
        ctx.lineTo(point[0], point[1]);
      });
      
      ctx.closePath();
      ctx.fillStyle = getRandomColor();
      ctx.fill();
      ctx.stroke(); // Draw the cell edges
    }
  });
}

// Function to save the pattern as an image
function savePattern() {
  var canvas = document.getElementById('artCanvas');
  var dataURL = canvas.toDataURL('image/png');
  var downloadLink = document.createElement('a');
  downloadLink.href = dataURL;
  downloadLink.download = 'generated-pattern.png';
  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
}
</script>
</body>
</html>
